import pickle
import matplotlib.pyplot as plt
import os
import warnings
warnings.filterwarnings("ignore", category=DeprecationWarning, module="numpy")

file_path = '/Users/matthewyoon/Documents/cs2370/GEDI/Data Preprocessing/Amazon_cs237_2024.pkl'

latitudes_to_plot = {
    1.670091, 1.638918, 1.857466, 1.764017, 2.27082, 2.522367, 2.338086, 1.906772, 2.324074, 2.301701, 2.463572, 2.539625, 2.342375, 2.434057, 1.959749, 2.401272, 1.991381, 2.322164, 2.179518, 1.567359, 2.526381, 1.917416, 1.76339, 2.543273, 1.629048, 1.971558, 2.382325, 2.132665, 1.827032, 1.718721, 1.874575, 1.695946, 2.001828, 1.766388, 2.468157, 2.103321, 1.802125, 2.319034, 2.196338, 2.116621, 1.55617, 2.348638, 2.108478, 2.318957, 2.469818, 2.062602, 2.267933, 2.09231, 1.988279, 2.317714, 2.316035, 1.688935, 2.256532, 1.701299, 2.526781, 2.418419, 2.384068, 1.942419, 1.65225, 1.978844, 2.087701, 1.551099, 1.966281, 2.008786, 2.093832, 2.112299, 1.877824, 1.734122, 1.958424, 1.722089, 1.896551, 2.365608, 2.046496, 2.095685, 1.583699, 2.402257, 2.172215, 2.358374, 1.793689, 2.089526, 2.430856, 2.43321, 1.992935, 1.626119, 1.881541, 2.171847, 2.08589, 2.51761, 1.657039, 2.266657, 2.065441, 2.412425, 2.359294, 2.428995, 2.111747, 1.9179, 2.347172, 1.773495, 2.121881, 2.122464, 2.10203, 2.192063, 2.076877, 2.01066, 1.987343, 2.037376, 2.196623, 2.3242, 2.170891, 1.668378, 2.044088, 2.221221, 2.424422, 1.82679, 1.682261, 2.326214, 2.059737, 2.473334, 2.185838, 2.312205, 2.299275, 2.331636, 1.578296, 2.241145, 2.356469, 1.751998, 2.190516, 1.803777, 1.853842, 2.361001, 2.193431, 2.339124, 1.984834, 2.03763, 2.226081, 2.102438, 2.12449, 2.093199, 1.944066, 2.543489, 1.796067, 1.919304, 2.107203, 2.002028, 2.492755, 2.366904, 1.95628, 2.195501, 2.29877, 1.716786, 1.657573, 2.362248, 1.881967, 2.453622, 1.985154, 2.014892, 1.737165, 1.862181, 2.176832, 2.477853, 1.723046, 2.296174, 2.394288, 2.257109, 1.884818, 2.287146, 2.426899, 1.889002, 2.476256, 1.92586, 2.011532, 1.671149, 2.356778, 1.992816, 2.033029, 2.00222, 1.832436, 2.475769, 1.602732, 2.2721, 2.395344, 2.440225, 2.310555, 2.257396, 1.555694, 1.693769, 1.590094, 2.373541, 1.652211, 2.491357, 2.310408, 2.533789, 2.055077, 2.492374, 2.361899, 2.227053, 2.541241, 1.964476, 2.400842, 2.124377, 2.092318, 2.290986, 2.204189, 2.022672, 1.785595, 1.827331, 2.229457, 1.799991, 2.205215, 2.329996, 1.660527, 2.07652, 2.356059, 1.798162, 1.552725, 1.898118, 2.00049, 2.41563, 2.02915, 2.22378, 2.268641, 1.704442, 2.520542, 1.995431, 2.295177, 2.244465, 1.583951, 2.451773, 2.4168, 1.898687, 2.277465, 2.474175, 2.45771, 1.924429, 2.336897, 2.368466, 2.368242, 2.374535, 2.390885, 2.344983, 1.742178, 2.542288, 2.347343, 2.32249, 2.05272, 1.628892, 1.86188, 1.986321, 1.875242, 1.74184, 2.064079, 2.520479, 1.585583, 2.348605, 1.59558, 2.29899, 2.540811, 1.587315, 2.254648, 2.502425, 1.647908, 1.980474, 1.932376, 2.119179, 1.62992, 1.598526, 2.248731, 1.674716, 1.730561, 2.489709, 2.421248, 2.063183, 2.374991, 1.893038, 1.73564, 2.442994, 1.728436, 2.417241, 2.376032, 2.40024, 2.244888, 1.974189, 2.070765, 1.733253, 1.612935, 1.871206, 1.793778, 2.449569, 2.40371, 1.760394, 2.063254, 2.119879, 2.23779, 2.249053, 2.420515, 1.759187, 2.266636, 1.873259, 2.292279, 1.965739, 1.699519, 2.02612, 1.594499, 2.297068, 2.028625, 2.024509, 2.28455, 2.236785, 2.222051, 2.151505, 1.906543, 1.770593, 2.360584, 1.630671, 2.54484, 2.341887, 2.172009, 2.475515, 2.50505, 2.405016, 2.072317, 1.946633, 1.547258, 2.527258, 2.089718, 2.422879, 2.407727, 2.256001, 1.650115, 1.601045, 2.365567, 1.605675, 1.724813, 2.250015, 2.481644, 1.964485, 1.620881, 2.502813, 1.738675, 2.47936, 2.300243, 2.251591, 2.387571, 1.72427, 1.782265, 1.785388, 1.888788, 1.948123, 1.59278, 2.3407, 2.497379, 2.300407, 2.533853, 2.487129, 1.646472, 2.003637, 1.997738, 2.458869, 2.446896, 2.392194, 1.589007, 2.125978, 1.623111, 1.689418, 1.599527, 2.535768, 2.002993, 2.141161, 2.189301, 2.119684, 1.834138, 2.536897, 1.872044, 1.740603, 2.106667, 2.019877, 2.338291, 1.695585, 2.38694, 1.898438, 1.745318, 1.663522, 1.589414, 2.395174, 2.43446, 1.628046, 1.72968, 1.995732, 2.241378, 1.552992, 2.110148, 1.725554, 2.247841, 2.243633, 2.138927, 2.185504, 1.546608, 1.729223, 1.986505, 1.814059, 1.628097, 1.884816, 2.443016, 2.443157, 1.972402, 2.269006, 1.634163, 2.258567, 2.309813, 2.147828, 1.620612, 2.110778, 1.680543, 2.384642, 1.750741, 2.531617, 1.802056, 2.289851, 1.94672, 2.246892, 1.910197, 1.5569, 2.398293, 2.384215, 1.755754, 1.724327, 2.132181, 1.900839, 2.21986, 1.982542, 1.961634, 2.358958, 2.12202, 2.510283, 2.34045, 1.830496, 2.164861, 1.552024, 2.24001, 2.095739, 1.936129, 1.699805, 2.17192, 1.938923, 2.091516, 2.23537, 1.768122, 1.936585, 1.693487, 1.87851, 1.777804, 2.062592, 1.565312, 1.663698, 2.539427, 1.994802, 1.902895, 2.256041, 2.170538, 1.718337, 1.763321, 1.674901, 1.664357, 1.930875, 2.485817, 1.633659, 2.33759, 2.172314, 2.337606, 1.786116, 1.898318, 2.04976, 1.584488, 1.885033, 2.085254, 1.720417, 2.393483, 2.082352, 2.309288, 1.905544, 1.783104, 1.778313, 1.674164, 2.341957, 1.88119, 1.717028, 1.691602, 2.2261, 2.268221, 1.682908, 1.566254, 2.444456, 2.300934, 2.31543, 1.611603, 1.918034, 1.596894, 1.550466, 2.139763, 2.096779, 2.177394, 2.337914, 1.851391, 2.296556, 2.359105, 1.737214, 2.245239, 1.664913, 1.87674, 1.55117, 1.834012, 2.059325, 1.680777, 1.566604, 1.570639, 2.124644, 1.683202, 1.726005, 1.631958, 2.373362, 1.957625, 1.828751, 2.249679, 2.217263, 1.684651, 2.017027, 1.656823, 2.448349, 2.001389, 2.400523, 1.751537, 2.17033, 1.882782, 2.439073, 1.681377, 1.681101, 1.798995, 2.458035, 1.71632, 2.184085, 1.940597, 2.513005, 2.416309, 2.486671, 1.648076, 2.350219, 2.085247, 2.277124, 2.486901, 1.575691, 2.01221, 1.678075, 1.87421, 1.631698, 2.025721, 1.700054, 1.989097, 2.049704, 2.04193, 1.903922, 2.293911, 1.613607, 1.790733, 1.910187, 1.747158, 1.676812, 1.953009, 2.065907, 2.535071, 1.648166, 1.613321, 2.151662, 1.65003, 2.192238, 1.586258, 1.654845, 2.045288, 1.671767, 2.303044, 2.443521, 1.650313, 1.797591, 2.278377, 1.682937, 1.804713, 1.813051, 2.055959, 2.040202, 1.832616, 1.67982, 2.37378, 1.552751, 1.728012, 1.810845, 1.585977, 1.560474, 1.762809, 1.603618, 1.704052, 1.843928, 1.655233, 1.854809, 1.635425, 1.781053, 1.586742, 2.510219, 2.211799, 1.984594, 1.751386, 1.713372, 1.618245, 1.820643, 2.146724, 2.088428, 2.435276, 1.63763, 2.544802, 1.749513, 1.982132, 1.670539, 2.228895, 2.050738, 1.579666, 1.615144, 2.217533, 2.241699, 2.266971, 1.596742, 1.851524, 2.523323, 1.68372, 1.904343, 2.086955, 1.756825, 2.468176, 1.606765, 2.398379, 1.705696, 1.935643, 1.705073, 1.660872, 1.835136, 2.211798, 2.222646, 1.77557, 2.197343, 1.610044, 2.539696, 1.836543, 1.667959, 2.319217, 1.893709, 1.704854, 1.654766, 1.600293, 1.742159, 2.348354, 1.751853, 2.250297, 1.824592, 1.913765, 2.047838, 2.286041, 1.944286, 2.030357, 1.898194, 2.288383, 1.926199, 1.974765, 1.583628, 1.782184, 1.585969, 2.110034, 1.919048, 1.779818, 1.709318, 2.065885, 1.895867, 1.577226, 2.131871, 2.02579, 2.438739, 2.22453, 2.161294, 2.495267, 2.30863, 2.264683, 1.924959, 1.876996, 1.913228, 1.88398, 1.654042, 2.266125, 2.076055, 1.622315, 2.086864, 2.021757, 2.474693, 1.928894, 2.015748, 2.117049, 2.260309, 1.964679, 2.227355, 2.334009, 2.068282, 2.088549, 2.142875, 2.175618, 2.046327, 1.862245, 1.759203, 1.952304, 2.19663, 2.397345, 2.360455, 1.646376, 1.901525, 2.491349, 2.014399, 1.744564, 2.027615, 2.173224, 2.090661, 1.673761, 2.119964, 2.245546, 2.464849, 1.656481, 1.741051, 2.539965, 1.961336, 1.749638, 2.159609, 1.878613, 1.832313, 2.347771, 1.991732, 2.519467, 2.282475, 1.869863, 1.984569, 2.039614, 2.493939, 2.229434, 2.024323, 2.202174, 2.417916, 2.539547, 2.074867, 1.601298, 2.189642, 1.972097, 2.007602, 1.757221, 2.179404, 2.526407, 2.31707, 2.081822, 2.054175, 2.250252, 2.037336, 1.936001, 2.007036, 1.813257, 1.99657, 1.670452, 2.270345, 2.011954, 2.258411, 2.015413, 2.463743, 1.981368, 1.70103, 2.486624, 1.815435, 2.236734, 2.046197, 2.17007, 1.892934, 2.240712, 1.655494, 1.842414, 2.198915, 1.769056, 2.072678, 1.997493, 1.865362, 2.007215, 2.048044, 2.216118, 2.365445, 2.343351, 2.277096, 1.722607, 1.870905, 1.648681, 2.136395, 2.070673, 2.510849, 2.367772, 1.861412, 2.347664, 2.437088, 2.417565, 2.092775, 1.913247, 2.063048, 1.894586, 1.930939, 1.777191, 1.883703, 2.374929, 2.520113, 2.473541, 2.540331, 1.937783, 2.216471, 1.827669, 2.025346, 2.186031, 2.282277, 2.176363, 2.283113, 2.296427, 1.95749, 1.607004, 2.012089, 2.080773, 1.990386, 2.537383, 2.504113, 1.858039, 1.990396, 2.131924, 2.344441, 2.002426, 2.345368, 2.167564, 1.726002, 1.75606, 1.649888, 2.109167, 2.380177, 2.100615, 2.299735, 2.460212, 1.859638, 1.889599, 1.879169, 2.153278, 1.878682, 2.258561, 1.772846, 1.982025, 2.310505, 2.12897, 2.037464
} 

output_folder = "output_plots" 
round_precision = 6 

os.makedirs(output_folder, exist_ok=True)

with open(file_path, "rb") as f:
    data = pickle.load(f)

for i in range(len(data['prop'])):
    entry = data['prop'][i]
    latitude = round(entry['geolocation/latitude_bin0'], round_precision)
    long = round(entry['geolocation/longitude_bin0'], round_precision)

    if latitude in latitudes_to_plot:
        latitudes_to_plot.remove(latitude)

        print('saving lat', latitude, '')

        # plot the waveform
        waveform = data['y'][i]
        plt.figure()
        plt.plot(waveform)
        plt.xlabel("Index (meters)")
        plt.ylabel("Energy")
        plt.title(f"Waveform for Lat {latitude}, Long {long}")

        # save
        plot_path = os.path.join(output_folder, f"lat_{latitude}.png")
        plt.savefig(plot_path)
        plt.close()

        if not latitudes_to_plot:
            break

print("Plots saved to:", output_folder)